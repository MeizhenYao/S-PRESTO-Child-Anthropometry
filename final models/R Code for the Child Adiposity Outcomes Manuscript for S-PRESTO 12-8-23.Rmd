---
title: "R Code for the Child Adiposity Outcomes Manuscript for S-PRESTO 12-8-23"
author: "Nathan Cohen"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: united
    highlight: tango
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    number_sections: yes
    df_print: paged
    fig_caption: yes
    fig_height: 7
    fig_width: 10
    self_contained: false
    code_folding: hide
  editor_options: 
    chunk_output_type: console
---


```{r setup, include=FALSE}
options(digits = 4)
knitr::opts_chunk$set(echo = TRUE, tidy=TRUE, cache=T, warning = FALSE)
options(qwraps2_markup = "markdown")
```

# Models for Internal WFL Z-Score
```{r, warning=FALSE, message=FALSE}
library(rlang)
library(clubSandwich)
library(WeightIt)
library(ResourceSelection)
library(parameters)
library(sjstats)
library(rms)
library(survminer)
library(survival)
library(broom)
library(data.table)   
library(gtsummary)
library(gt)
library(tidyverse)
library(ggpubr)
library(cowplot)
library(gridExtra)
library(readxl)
library(sandwich)
library(boot)
library(table1)
library(flextable)
library(plyr)
library(Rcpp)
library(modelr)
library(lme4)
library(nlme)
library(readr)
library(gWQS)
library(broom.mixed)
library(yaml)
library(rmarkdown)
library(officer)
library(scales)
library(spatstat)
library(survey)
library(MatchIt)
#library(devtools)
library(cobalt)
library(RItools)
library(optmatch)
library(mice)
library(gtsummary)
library(tidyr)
library(tidyverse)
library(grid)
library(gtable)
library(ggh4x)
library(anthro)
library(xgboost)
library(lcmm)
library(tidyverse)
library(gridExtra)
library(ggsci)
library(flexmix)
library(plotly)
library(gapminder)
library(manipulateWidget)
library(lcmm)
library(BWQS)
library(bkmr)
library(qgcomp)
library(alr4)
library(stats)

set.seed(46377662)

#-------------------------------------------------------import data set

blood_child_who_stan_updated <- read.csv("~/Projects/S-PRESTO/input/anthropometry/blood_child_who_stan_impute_toy4_12182023.csv", header=TRUE)

blood_child_who_stan <- read_excel("~/Projects/S-PRESTO/input/prepared data set/Nate/Nate_PFAS_whole_cohort_20230316.xlsx")

blood_child_who_stan <- blood_child_who_stan %>% 
         select(-matches("Days_since_birth") & -matches("bw_sex") & -matches("bw_birth_GA"))

blood_child_who_stan <- merge(x=blood_child_who_stan_updated, y=blood_child_who_stan, by="Subject_ID", all.x=TRUE)

#------------------------------------------------------- reformate variables
### demographic factors
#### Analysis Batch
blood_child_who_stan$Analysis_Batch_recat <- factor(blood_child_who_stan$Analysis_Batch_recat,
                                                    levels = c("B6","B2","B3","B4","B5"))




#### ethnicity categorization
blood_child_who_stan$ethnicity_specified_recat <- factor(blood_child_who_stan$ethnicity_specified_recat,
                                                         levels=c("Chinese","Malay","Indian"))


#### highest education                            
blood_child_who_stan$pcv1_highest_education_completed_recat <- factor(blood_child_who_stan$pcv1_highest_education_completed_recat,
                                                                      levels=c("University","Primary/Secondary/Post_secondary"))



#### parity status
blood_child_who_stan$pcv1_parity_recat <- factor(blood_child_who_stan$pcv1_parity_recat,
                                                 levels=c("0",">= 1"))

blood_child_who_stan$bw_sex <- factor(blood_child_who_stan$bw_sex,
                                                 levels=c("1","2"))


#### Smoking status
for(i in 1:nrow(blood_child_who_stan)){
  if(blood_child_who_stan$pcv1_smoker[i] == 2){
    blood_child_who_stan$pcv1_smoker[i] <- 1
  }
}

blood_child_who_stan$pcv1_smoker <- factor(blood_child_who_stan$pcv1_smoker, levels=c("0", "1"))

blood_child_who_stan$Subject_ID = as.factor(blood_child_who_stan$Subject_ID)
blood_child_who_stan$Subject_ID2 = as.numeric(blood_child_who_stan$Subject_ID) #CHANGES TO NUMERICAL ORDER NOT ACTUALLY THE LEVEL ANEM!

blood_child_who_stan_updated$Subject_ID = as.factor(blood_child_who_stan_updated$Subject_ID)
blood_child_who_stan_updated$Subject_ID2 = as.numeric(blood_child_who_stan_updated$Subject_ID) #CHANGES TO NUMERICAL ORDER NOT ACTUALLY THE LEVEL ANEM!

blood_child_who_stan_age_long <- blood_child_who_stan %>% 
  select(Subject_ID2, Analysis_Batch_recat, age_at_recruitment, pcv1_highest_education_completed_recat,
         ethnicity_specified_recat, pcv1_parity_recat, pcv1_smoker, pcv1_bmi, pgv1_bmi, bw_sex, PFOS_Total_quar_num, 
         PFOA_Linear_quar_num, PFNA_quar_num, PFDA_quar_num, PFHpA_quar_num, PFHpS_quar_num, PFHxS_quar_num, 
         PFOS_Total, PFOA_Linear, PFNA, PFDA, PFHpA, PFHpS, PFHxS, SP_CWH11AGE_merge, SP_CWH14AGE, SP_CWH15AGE, SP_CWH16AGE,        
         SP_CWH17AGE, SP_CWH19AGE, SP_CWH20AGE, SP_CWH21AGE, SP_CWH22AGE, SP_CWH23AGE)   %>% 
  pivot_longer(
    cols = starts_with("SP_CWH"),
    names_to = "visit",
    names_prefix = "Days_since_birth_",
    values_to = "Days_since_birth",
    values_drop_na = FALSE
  )

### Rename the visits ###
for(i in 1:nrow(blood_child_who_stan_age_long)){
  if(blood_child_who_stan_age_long$visit[i] == "SP_CWH11AGE_merge"){
    blood_child_who_stan_age_long$visit[i] <- "del"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH14AGE"){
    blood_child_who_stan_age_long$visit[i] <- "wk3"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH15AGE"){
    blood_child_who_stan_age_long$visit[i] <- "wk6"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH16AGE"){
    blood_child_who_stan_age_long$visit[i] <- "m3"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH17AGE"){
    blood_child_who_stan_age_long$visit[i] <- "m6"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH19AGE"){
    blood_child_who_stan_age_long$visit[i] <- "m12"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH20AGE"){
    blood_child_who_stan_age_long$visit[i] <- "m18"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH21AGE"){
    blood_child_who_stan_age_long$visit[i] <- "m24"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH22AGE"){
    blood_child_who_stan_age_long$visit[i] <- "m36"
  }
  else if(blood_child_who_stan_age_long$visit[i] == "SP_CWH23AGE"){
    blood_child_who_stan_age_long$visit[i] <- "y4"
  }
}

blood_child_who_stan_zwfl_long <- blood_child_who_stan_updated %>% 
  select(Subject_ID2, starts_with("zwfl_internal_")) %>% 
  pivot_longer(
    cols = starts_with("zwfl_internal_"),
    names_to = "visit",
    names_prefix = "zwfl_internal_",
    values_to = "zwfl_internal",
    values_drop_na = FALSE
  )

for(i in 1:nrow(blood_child_who_stan_zwfl_long)){
  if(blood_child_who_stan_zwfl_long$visit[i] == "del_merge"){
    blood_child_who_stan_zwfl_long$visit[i] <- "del"
  }
}

blood_child_who_stan_zwfl_long <- as.data.frame(blood_child_who_stan_zwfl_long %>% 
                                             left_join(blood_child_who_stan_age_long, by = c("Subject_ID2", "visit")))

blood_child_who_stan_zbmi_long <- blood_child_who_stan_updated %>% 
  select(Subject_ID2, starts_with("zbmi_")) %>% 
  pivot_longer(
    cols = starts_with("zbmi_"),
    names_to = "visit",
    names_prefix = "zbmi_",
    values_to = "zbmi",
    values_drop_na = FALSE
  )

for(i in 1:nrow(blood_child_who_stan_zbmi_long)){
  if(blood_child_who_stan_zbmi_long$visit[i] == "del_merge"){
    blood_child_who_stan_zbmi_long$visit[i] <- "del"
  }
}

blood_child_who_stan_zbmi_long <- as.data.frame(blood_child_who_stan_zbmi_long %>% 
                                             left_join(blood_child_who_stan_age_long, by = c("Subject_ID2", "visit")))


blood_child_who_stan_cbmi_long <- blood_child_who_stan_updated %>% 
  select(Subject_ID2, starts_with("cbmi_")) %>% 
  pivot_longer(
    cols = starts_with("cbmi_"),
    names_to = "visit",
    names_prefix = "cbmi_",
    values_to = "cbmi",
    values_drop_na = FALSE
  )

for(i in 1:nrow(blood_child_who_stan_cbmi_long)){
  if(blood_child_who_stan_cbmi_long$visit[i] == "del_merge"){
    blood_child_who_stan_cbmi_long$visit[i] <- "del"
  }
}

blood_child_who_stan_cbmi_long <- as.data.frame(blood_child_who_stan_cbmi_long %>% 
                                             left_join(blood_child_who_stan_age_long, by = c("Subject_ID2", "visit")))



blood_child_who_stan_long1 <- merge(x=blood_child_who_stan_zwfl_long, y=blood_child_who_stan_zbmi_long[,c("Subject_ID2", "visit", "zbmi")], 
                                   by=c("Subject_ID2", "visit"))


blood_child_who_stan_long <- merge(x=blood_child_who_stan_long1, y=blood_child_who_stan_cbmi_long[,c("Subject_ID2", "visit", "cbmi")], 
                                   by=c("Subject_ID2", "visit"))


blood_child_who_stan_long$Years_since_birth <- blood_child_who_stan_long$Days_since_birth/365.25

pfas_subjects <- blood_child_who_stan_long[seq(1, nrow(blood_child_who_stan_long), 10),
                                           c("Subject_ID2", "PFOS_Total", "PFOA_Linear", "PFNA", "PFDA", "PFHpA", "PFHpS", "PFHxS")]

pfas_subjects$PFOS_Total_quar_num <- pfas_subjects$PFOS_Total

PFOS_Total_quar <- quantile(pfas_subjects$PFOS_Total, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFOS_Total[i])==TRUE){
	  pfas_subjects$PFOS_Total_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFOS_Total[i] <= as.numeric(PFOS_Total_quar[1])){
	  pfas_subjects$PFOS_Total_quar_num[i]<-1
  }
  else if (pfas_subjects$PFOS_Total[i] > as.numeric(PFOS_Total_quar[1]) & pfas_subjects$PFOS_Total[i] <= as.numeric(PFOS_Total_quar[2])){
	  pfas_subjects$PFOS_Total_quar_num[i]<-2
  }
  else if (pfas_subjects$PFOS_Total[i] > as.numeric(PFOS_Total_quar[2]) & pfas_subjects$PFOS_Total[i] <= as.numeric(PFOS_Total_quar[3])){
	  pfas_subjects$PFOS_Total_quar_num[i]<-3
  }
  else if (pfas_subjects$PFOS_Total[i] > as.numeric(PFOS_Total_quar[3])){
	  pfas_subjects$PFOS_Total_quar_num[i]<-4
  }
}

pfas_subjects$PFOA_Linear_quar_num <- pfas_subjects$PFOA_Linear

PFOA_Linear_quar <- quantile(pfas_subjects$PFOA_Linear, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFOA_Linear[i])==TRUE){
	  pfas_subjects$PFOA_Linear_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFOA_Linear[i] <= as.numeric(PFOA_Linear_quar[1])){
	  pfas_subjects$PFOA_Linear_quar_num[i]<-1
  }
  else if (pfas_subjects$PFOA_Linear[i] > as.numeric(PFOA_Linear_quar[1]) & pfas_subjects$PFOA_Linear[i] <= as.numeric(PFOA_Linear_quar[2])){
	  pfas_subjects$PFOA_Linear_quar_num[i]<-2
  }
  else if (pfas_subjects$PFOA_Linear[i] > as.numeric(PFOA_Linear_quar[2]) & pfas_subjects$PFOA_Linear[i] <= as.numeric(PFOA_Linear_quar[3])){
	  pfas_subjects$PFOA_Linear_quar_num[i]<-3
  }
  else if (pfas_subjects$PFOA_Linear[i] > as.numeric(PFOA_Linear_quar[3])){
	  pfas_subjects$PFOA_Linear_quar_num[i]<-4
  }
}

pfas_subjects$PFNA_quar_num <- pfas_subjects$PFNA

PFNA_quar <- quantile(pfas_subjects$PFNA, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFNA[i])==TRUE){
	  pfas_subjects$PFNA_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFNA[i] <= as.numeric(PFNA_quar[1])){
	  pfas_subjects$PFNA_quar_num[i]<-1
  }
  else if (pfas_subjects$PFNA[i] > as.numeric(PFNA_quar[1]) & pfas_subjects$PFNA[i] <= as.numeric(PFNA_quar[2])){
	  pfas_subjects$PFNA_quar_num[i]<-2
  }
  else if (pfas_subjects$PFNA[i] > as.numeric(PFNA_quar[2]) & pfas_subjects$PFNA[i] <= as.numeric(PFNA_quar[3])){
	  pfas_subjects$PFNA_quar_num[i]<-3
  }
  else if (pfas_subjects$PFNA[i] > as.numeric(PFNA_quar[3])){
	  pfas_subjects$PFNA_quar_num[i]<-4
  }
}

pfas_subjects$PFDA_quar_num <- pfas_subjects$PFDA

PFDA_quar <- quantile(pfas_subjects$PFDA, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFDA[i])==TRUE){
	  pfas_subjects$PFDA_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFDA[i] <= as.numeric(PFDA_quar[1])){
	  pfas_subjects$PFDA_quar_num[i]<-1
  }
  else if (pfas_subjects$PFDA[i] > as.numeric(PFDA_quar[1]) & pfas_subjects$PFDA[i] <= as.numeric(PFDA_quar[2])){
	  pfas_subjects$PFDA_quar_num[i]<-2
  }
  else if (pfas_subjects$PFDA[i] > as.numeric(PFDA_quar[2]) & pfas_subjects$PFDA[i] <= as.numeric(PFDA_quar[3])){
	  pfas_subjects$PFDA_quar_num[i]<-3
  }
  else if (pfas_subjects$PFDA[i] > as.numeric(PFDA_quar[3])){
	  pfas_subjects$PFDA_quar_num[i]<-4
  }
}

pfas_subjects$PFHpA_quar_num <- pfas_subjects$PFHpA

PFHpA_quar <- quantile(pfas_subjects$PFHpA, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFHpA[i])==TRUE){
	  pfas_subjects$PFHpA_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFHpA[i] <= as.numeric(PFHpA_quar[1])){
	  pfas_subjects$PFHpA_quar_num[i]<-1
  }
  else if (pfas_subjects$PFHpA[i] > as.numeric(PFHpA_quar[1]) & pfas_subjects$PFHpA[i] <= as.numeric(PFHpA_quar[2])){
	  pfas_subjects$PFHpA_quar_num[i]<-2
  }
  else if (pfas_subjects$PFHpA[i] > as.numeric(PFHpA_quar[2]) & pfas_subjects$PFHpA[i] <= as.numeric(PFHpA_quar[3])){
	  pfas_subjects$PFHpA_quar_num[i]<-3
  }
  else if (pfas_subjects$PFHpA[i] > as.numeric(PFHpA_quar[3])){
	  pfas_subjects$PFHpA_quar_num[i]<-4
  }
}

pfas_subjects$PFHpS_quar_num <- pfas_subjects$PFHpS

PFHpS_quar <- quantile(pfas_subjects$PFHpS, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFHpS[i])==TRUE){
	  pfas_subjects$PFHpS_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFHpS[i] <= as.numeric(PFHpS_quar[1])){
	  pfas_subjects$PFHpS_quar_num[i]<-1
  }
  else if (pfas_subjects$PFHpS[i] > as.numeric(PFHpS_quar[1]) & pfas_subjects$PFHpS[i] <= as.numeric(PFHpS_quar[2])){
	  pfas_subjects$PFHpS_quar_num[i]<-2
  }
  else if (pfas_subjects$PFHpS[i] > as.numeric(PFHpS_quar[2]) & pfas_subjects$PFHpS[i] <= as.numeric(PFHpS_quar[3])){
	  pfas_subjects$PFHpS_quar_num[i]<-3
  }
  else if (pfas_subjects$PFHpS[i] > as.numeric(PFHpS_quar[3])){
	  pfas_subjects$PFHpS_quar_num[i]<-4
  }
}

pfas_subjects$PFHxS_quar_num <- pfas_subjects$PFHxS

PFHxS_quar <- quantile(pfas_subjects$PFHxS, c(1/4,1/2,3/4), na.rm=TRUE, type=2)

for(i in 1:nrow(pfas_subjects)){
  if (is.na(pfas_subjects$PFHxS[i])==TRUE){
	  pfas_subjects$PFHxS_quar_num[i]<-NA
  }
  else if (pfas_subjects$PFHxS[i] <= as.numeric(PFHxS_quar[1])){
	  pfas_subjects$PFHxS_quar_num[i]<-1
  }
  else if (pfas_subjects$PFHxS[i] > as.numeric(PFHxS_quar[1]) & pfas_subjects$PFHxS[i] <= as.numeric(PFHxS_quar[2])){
	  pfas_subjects$PFHxS_quar_num[i]<-2
  }
  else if (pfas_subjects$PFHxS[i] > as.numeric(PFHxS_quar[2]) & pfas_subjects$PFHxS[i] <= as.numeric(PFHxS_quar[3])){
	  pfas_subjects$PFHxS_quar_num[i]<-3
  }
  else if (pfas_subjects$PFHxS[i] > as.numeric(PFHxS_quar[3])){
	  pfas_subjects$PFHxS_quar_num[i]<-4
  }
}

blood_child_who_stan_long <- subset(blood_child_who_stan_long, 
                                    select=-c(PFOS_Total_quar_num, PFOA_Linear_quar_num, PFNA_quar_num, 
                                              PFDA_quar_num, PFHpA_quar_num, PFHpS_quar_num, PFHxS_quar_num))

pfas_subjects <- subset(pfas_subjects, select=-c(PFOS_Total, PFOA_Linear, PFNA, PFDA, PFHpA, PFHpS, PFHxS))

blood_child_who_stan_long <- merge(x=blood_child_who_stan_long, y=pfas_subjects, by="Subject_ID2", all.x=TRUE)

### Drop covariates and merge back in so we can fill in the missing values??????
blood_child_who_stan_long <- subset(blood_child_who_stan_long, 
                                    select=-c(Analysis_Batch_recat, age_at_recruitment, pcv1_highest_education_completed_recat, 
                                              ethnicity_specified_recat, pcv1_parity_recat, pcv1_smoker, pcv1_bmi, pgv1_bmi, bw_sex))

covariate_data <- subset(blood_child_who_stan, select=c(Subject_ID2, Analysis_Batch_recat, age_at_recruitment,
                                                        pcv1_highest_education_completed_recat, ethnicity_specified_recat, 
                                                        pcv1_parity_recat, pcv1_smoker, pcv1_bmi, pgv1_bmi, bw_sex))

blood_child_who_stan_long <- merge(x=blood_child_who_stan_long, y=covariate_data, by="Subject_ID2", all.x=TRUE)

### Impute missing BMI for the one subject
for(i in 1:nrow(blood_child_who_stan_long)){
  if(is.na(blood_child_who_stan_long$pcv1_bmi[i])){
    blood_child_who_stan_long$pcv1_bmi[i] <- blood_child_who_stan_long$pgv1_bmi[i]
  }
}

blood_child_who_stan_long$visit <- factor(blood_child_who_stan_long$visit, 
                                          levels=c("del", "wk3", "wk6", "m3", "m6", "m12", "m18", "m24", "m36", "y4"))

blood_child_who_stan_long<- blood_child_who_stan_long %>% 
                            mutate(visit_re = case_when(visit == "del" ~ 1,
                                                        visit == "wk3" ~ 3,
                                                        visit == "wk6" ~ 6,
                                                        visit == "m3" ~ 12,
                                                        visit == "m6" ~ 24,
                                                        visit == "m12" ~ 48,
                                                        visit == "m18" ~ 72,
                                                        visit == "m24" ~ 96,
                                                        visit == "m36" ~ 144,
                                                        visit == "y4" ~ 192))
```


```{r}


blood_child_who_stan_long$Subject_ID2<- factor(blood_child_who_stan_long$Subject_ID2)

p<- ggplot(blood_child_who_stan_long, aes(x=visit_re, y=cbmi)) + 
    geom_line(aes(group = Subject_ID2), alpha = 0.3) +                     #Add individual profiles
    stat_summary(fun = mean, geom = "line", size = 2, group = 1) + #Add mean profile line
    stat_summary(fun = mean, geom = "point", size = 3)+
    guides(color = "none")

p


jpeg("~/Projects/S-PRESTO/code/R/chemical & child anthropometry/Nate/12182023/bmi_age_mean.jpeg",
     units="in", width=17, height=12, res=100)

p


dev.off()





p1 <- blood_child_who_stan_cbmi_long %>% 
       ggplot(aes(x=visit, y=cbmi, fill=visit)) + 
       geom_boxplot() 
               

p1


## PFHxS LEVEL 1
blood_child_who_stan_cbmi_long1<- blood_child_who_stan_cbmi_long %>% filter(PFHxS_quar_num == 1)


p1 <- blood_child_who_stan_cbmi_long1 %>% 
       ggplot(aes(x=visit, y=cbmi, fill=visit)) + 
       geom_boxplot()
               

p1


## PFHxS LEVEL 2
blood_child_who_stan_cbmi_long2<- blood_child_who_stan_cbmi_long %>% filter(PFHxS_quar_num == 2)


p2 <- blood_child_who_stan_cbmi_long2 %>% 
       ggplot(aes(x=visit, y=cbmi, fill=visit)) + 
       geom_boxplot()
               

p2


## PFHxS LEVEL 3
blood_child_who_stan_cbmi_long3<- blood_child_who_stan_cbmi_long %>% filter(PFHxS_quar_num == 3)


p3 <- blood_child_who_stan_cbmi_long3 %>% 
       ggplot(aes(x=visit, y=cbmi, fill=visit)) + 
       geom_boxplot()
               

p3


## PFHxS LEVEL 4
blood_child_who_stan_cbmi_long4<- blood_child_who_stan_cbmi_long %>% filter(PFHxS_quar_num == 4)


p4 <- blood_child_who_stan_cbmi_long4 %>% 
       ggplot(aes(x=visit, y=cbmi, fill=visit)) + 
       geom_boxplot()
               

p4


```



## PFHxS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHxS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhxs") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOS_Total_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfos") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOA_Linear_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfoa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFNA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFNA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfna") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhpa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhps") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFDA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFDA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfda") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## Coefficient Plot
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zwfl_internal"),
                           labels = c("Weight for Length Internal Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna",
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA",
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>%
  ggplot(aes(x=estimate, y=Chemical))+
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high, color=Chemical), width = 0.4, size=1.5) +
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(outcome_variable), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Including Only Males
```{r}
```

## PFHxS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHxS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhxs") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOS_Total_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfos") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOA_Linear_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfoa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFNA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFNA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfna") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhpa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhps") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFDA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFDA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfda") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## Coefficient Plot - Males
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zwfl_internal"),
                           labels = c("Weight for Length Internal Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna",
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA",
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>%
  ggplot(aes(x=estimate, y=Chemical))+
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high, color=Chemical), width = 0.4, size=1.5) +
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(outcome_variable), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Including Only Females
```{r}
```

## PFHxS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHxS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhxs") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOS_Total_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfos") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOA_Linear_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfoa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFNA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFNA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfna") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhpa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhps") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFDA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFDA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfda") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## Coefficient Plot - Females
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zwfl_internal"),
                           labels = c("Weight for Length Internal Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna",
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA",
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>%
  ggplot(aes(x=estimate, y=Chemical))+
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high, color=Chemical), width = 0.4, size=1.5) +
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(outcome_variable), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Testing for Interaction by Child Sex
```{r}
```

## PFHxS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             PFHxS_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel

```

## PFOS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             PFOS_Total_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFOA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             PFOA_Linear_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFNA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             PFNA_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFNA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFHpA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             PFHpA_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFHpS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             PFHpS_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFDA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             PFDA_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zwfl_internal"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFDA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

# Models Treating PFAS as Quartiles - Individual Time Points
```{r}
```

## PFHxS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHxS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhxs")

```

## PFOS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOS_Total_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfos")

```

## PFOA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOA_Linear_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfoa")

```

## PFNA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFNA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfna")

```

## PFHpA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhpa")

```

## PFHpS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhps")

```

## PFDA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFDA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfda")

```

## Coefficient Plot
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zwfl_internal"),
                           labels = c("Weight for Length Internal Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna", 
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA", 
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))

mixed_effect_plot$Visit <- factor(mixed_effect_plot$Visit,
                            levels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"),
                            labels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>% 
  ggplot(aes(x=Estimate, y=Chemical))+
  geom_errorbar(aes(xmin = Lower, xmax = Upper, color=Chemical), width = 0.4, size=1.5) + 
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(Visit), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+ 
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Individual Time Points - Males
```{r}
```

## PFHxS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHxS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhxs")

```

## PFOS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOS_Total_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfos")

```

## PFOA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOA_Linear_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfoa")

```

## PFNA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFNA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfna")

```

## PFHpA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhpa")

```

## PFHpS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhps")

```

## PFDA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFDA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfda")

```

## Coefficient Plot - Males
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zwfl_internal"),
                           labels = c("Weight for Length Internal Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna", 
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA", 
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))

mixed_effect_plot$Visit <- factor(mixed_effect_plot$Visit,
                            levels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"),
                            labels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>% 
  ggplot(aes(x=Estimate, y=Chemical))+
  geom_errorbar(aes(xmin = Lower, xmax = Upper, color=Chemical), width = 0.4, size=1.5) + 
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(Visit), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+ 
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Individual Time Points - Females
```{r}
```

## PFHxS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHxS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhxs")

```

## PFOS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOS_Total_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfos")

```

## PFOA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOA_Linear_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfoa")

```

## PFNA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFNA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfna")

```

## PFHpA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhpa")

```

## PFHpS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhps")

```

## PFDA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zwfl_internal ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFDA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zwfl_internal", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfda")

```

## Coefficient Plot - Females
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zwfl_internal"),
                           labels = c("Weight for Length Internal Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna", 
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA", 
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))

mixed_effect_plot$Visit <- factor(mixed_effect_plot$Visit,
                            levels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"),
                            labels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>% 
  ggplot(aes(x=Estimate, y=Chemical))+
  geom_errorbar(aes(xmin = Lower, xmax = Upper, color=Chemical), width = 0.4, size=1.5) + 
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(Visit), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+ 
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```


# Models for BMI Z-Score
```{r}
```

## PFHxS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHxS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhxs") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOS_Total_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfos") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOA_Linear_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfoa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFNA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFNA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfna") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhpa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhps") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFDA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFDA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfda") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## Coefficient Plot
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zbmi"),
                           labels = c("BMI Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna",
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA",
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>%
  ggplot(aes(x=estimate, y=Chemical))+
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high, color=Chemical), width = 0.4, size=1.5) +
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(outcome_variable), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Including Only Males
```{r}
```

## PFHxS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHxS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhxs") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOS_Total_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfos") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOA_Linear_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfoa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFNA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFNA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfna") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhpa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhps") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFDA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFDA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfda") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## Coefficient Plot - Males
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zbmi"),
                           labels = c("BMI Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna",
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA",
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>%
  ggplot(aes(x=estimate, y=Chemical))+
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high, color=Chemical), width = 0.4, size=1.5) +
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(outcome_variable), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Including Only Females
```{r}
```

## PFHxS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHxS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhxs") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                        data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOS_Total_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfos") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFOA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFOA_Linear_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfoa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFNA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFNA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfna") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhpa") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFHpS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFHpS_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfhps") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## PFDA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             (1|Subject_ID2),
                                                      data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs_data %>%
                                     filter(term == "PFDA_quar_num:Years_since_birth")%>%
                                     mutate(exposure = "pfda") %>%
                                     select(outcome_variable, exposure, estimate, conf.low, conf.high)

```

## Coefficient Plot - Females
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zbmi"),
                           labels = c("BMI Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna",
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA",
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>%
  ggplot(aes(x=estimate, y=Chemical))+
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high, color=Chemical), width = 0.4, size=1.5) +
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(outcome_variable), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Testing for Interaction by Child Sex
```{r}
```

## PFHxS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHxS_quar_num*Years_since_birth  +
                                                             PFHxS_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFHxS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel

```

## PFOS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOS_Total_quar_num*Years_since_birth  +
                                                             PFOS_Total_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFOS_Total_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFOA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFOA_Linear_quar_num*Years_since_birth  +
                                                             PFOA_Linear_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFOA_Linear_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFNA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFNA_quar_num*Years_since_birth  +
                                                             PFNA_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFNA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFNA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFHpA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpA_quar_num*Years_since_birth  +
                                                             PFHpA_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFHpA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFHpS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFHpS_quar_num*Years_since_birth  +
                                                             PFHpS_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFHpS_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

## PFDA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()

    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment +
                                                             pcv1_highest_education_completed_recat + ethnicity_specified_recat +
                                                             pcv1_parity_recat + pcv1_smoker + pcv1_bmi +
                                                             PFDA_quar_num*Years_since_birth  +
                                                             PFDA_quar_num*Years_since_birth*bw_sex +
                                                             (1|Subject_ID2), data = blood_child_who_stan_long)

    ## 3. number of obs
    number_obs[1]<- nrow(blood_child_who_stan_long)


## extract data from models
### extract results to a list
child_anthro_mixed_coefs<- lapply(child_anthro_mixed, tidy, conf.int = T)

### add number of obs
  child_anthro_mixed_coefs[[1]]<- child_anthro_mixed_coefs[[1]] %>%
                                  mutate(obs=number_obs[1])
### add outcome variables
names(child_anthro_mixed_coefs) <- "zbmi"

### combine results into one dataframe
child_anthro_mixed_coefs_data1 <- bind_rows(child_anthro_mixed_coefs, .id = "outcome_variable")

### refine results in data
child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data1 %>%
                           filter(term == "PFDA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable,obs, term, estimate,  conf.low, conf.high, statistic)

if(child_anthro_mixed_coefs_data$statistic < 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*pt(child_anthro_mixed_coefs_data$statistic, df=168)
}
if(child_anthro_mixed_coefs_data$statistic > 0){
  child_anthro_mixed_coefs_data$pvalue <- 2*(1-pt(child_anthro_mixed_coefs_data$statistic, df=168))
}

child_anthro_mixed_coefs_data <- child_anthro_mixed_coefs_data %>%
                           filter(term == "PFDA_quar_num:Years_since_birth:bw_sex2") %>%
                           select(outcome_variable, pvalue)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs_data, groups = "outcome_variable"))%>%
        theme_box()
tabel
#

```

# Models Treating PFAS as Quartiles - Individual Time Points
```{r}
```

## PFHxS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHxS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhxs")

```

## PFOS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOS_Total_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfos")

```

## PFOA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOA_Linear_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfoa")

```

## PFNA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFNA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfna")

```

## PFHpA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhpa")

```

## PFHpS
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhps")

```

## PFDA
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFDA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long)

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfda")

```

## Coefficient Plot
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zbmi"),
                           labels = c("BMI Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna", 
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA", 
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))

mixed_effect_plot$Visit <- factor(mixed_effect_plot$Visit,
                            levels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"),
                            labels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>% 
  ggplot(aes(x=Estimate, y=Chemical))+
  geom_errorbar(aes(xmin = Lower, xmax = Upper, color=Chemical), width = 0.4, size=1.5) + 
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(Visit), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+ 
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Individual Time Points - Males
```{r}
```

## PFHxS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHxS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhxs")

```

## PFOS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOS_Total_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfos")

```

## PFOA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOA_Linear_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfoa")

```

## PFNA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFNA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfna")

```

## PFHpA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhpa")

```

## PFHpS - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhps")

```

## PFDA - Males
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFDA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 1,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfda")

```

## Coefficient Plot - Males
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zbmi"),
                           labels = c("BMI Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna", 
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA", 
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))

mixed_effect_plot$Visit <- factor(mixed_effect_plot$Visit,
                            levels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"),
                            labels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>% 
  ggplot(aes(x=Estimate, y=Chemical))+
  geom_errorbar(aes(xmin = Lower, xmax = Upper, color=Chemical), width = 0.4, size=1.5) + 
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(Visit), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+ 
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

# Models Treating PFAS as Quartiles - Individual Time Points - Females
```{r}
```

## PFHxS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHxS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHxS_quar_num+`PFHxS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhxs_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhxs")

```

## PFOS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOS_Total_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOS_Total_quar_num+`PFOS_Total_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfos_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfos")

```

## PFOA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFOA_Linear_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFOA_Linear_quar_num+`PFOA_Linear_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfoa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfoa")

```

## PFNA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFNA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFNA_quar_num+`PFNA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfna_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfna")

```

## PFHpA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpA_quar_num+`PFHpA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhpa_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhpa")

```

## PFHpS - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFHpS_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFHpS_quar_num+`PFHpS_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfhps_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfhps")

```

## PFDA - Females
```{r}

## Fit the models
    child_anthro_mixed<- list()
    number_obs<- vector()
      
    child_anthro_mixed[[1]]<- lmer(formula = zbmi ~ Analysis_Batch_recat + age_at_recruitment + 
                                    pcv1_highest_education_completed_recat + ethnicity_specified_recat + 
                                    pcv1_parity_recat + pcv1_smoker + pcv1_bmi + 
                                    PFDA_quar_num*visit  + 
                                    (1|Subject_ID2), data = blood_child_who_stan_long[blood_child_who_stan_long$bw_sex == 2,])

    # Estimate at delivery (reference group)
    deliveryEst <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num")
    colnames(deliveryEst) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 3
    wk3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk3`")
    colnames(wk3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at week 6
    wk6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitwk6`")
    colnames(wk6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 3
    m3Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm3`")
    colnames(m3Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 6
    m6Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm6`")
    colnames(m6Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 12
    m12Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm12`")
    colnames(m12Est) <- c("Estimate", "SE", "Lower", "Upper")

    # Estimate at month 18
    m18Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm18`")
    colnames(m18Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 24
    m24Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm24`")
    colnames(m24Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 36
    m36Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visitm36`")
    colnames(m36Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    # Estimate at month 48
    m48Est <- deltaMethod(child_anthro_mixed[[1]], "PFDA_quar_num+`PFDA_quar_num:visity4`")
    colnames(m48Est) <- c("Estimate", "SE", "Lower", "Upper")
    
    child_anthro_mixed_coefs <- data.frame(rbind(deliveryEst, wk3Est, wk6Est, m3Est, m6Est, m12Est, m18Est, 
                                                 m24Est, m36Est, m48Est))
    
    child_anthro_mixed_coefs$Visit <- c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                        "Month 24", "Month 36", "Month 48")
    
    child_anthro_mixed_coefs$outcome_variable <- rep("zbmi", length=10)

### put result into one table
tabel<- flextable(as_grouped_data(child_anthro_mixed_coefs, groups = "outcome_variable"))%>% 
        theme_box()
tabel
# 
# ## Export data input for plot
pfda_plot<- child_anthro_mixed_coefs %>%
                                     mutate(exposure = "pfda")

```

## Coefficient Plot - Females
```{r}


mixed_effect_plot<- rbind(pfhxs_plot,
                          pfos_plot,
                          pfoa_plot,
                          pfna_plot,
                          pfhpa_plot,
                          pfhps_plot,
                          pfda_plot)


### Generate an order for the variables ###
mixed_effect_plot$outcome_variable <- factor(mixed_effect_plot$outcome_variable,
                           levels = c("zbmi"),
                           labels = c("BMI Z-Score"))


mixed_effect_plot$Chemical <- factor(mixed_effect_plot$exposure,
                            levels = c("pfhxs", "pfos",
                                       "pfoa", "pfna", 
                                       "pfhpa", "pfhps", "pfda"),
                            labels = c("PFHxS", "PFOS", "PFOA", 
                                       "PFNA", "PFHpA", "PFHpS", "PFDA"))

mixed_effect_plot$Visit <- factor(mixed_effect_plot$Visit,
                            levels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"),
                            labels = c("Delivery", "Week 3", "Week 6", "Month 3", "Month 6", "Month 12", "Month 18", 
                                       "Month 24", "Month 36", "Month 48"))


### Create the plot ###

pops_plasma_plot <- mixed_effect_plot %>% 
  ggplot(aes(x=Estimate, y=Chemical))+
  geom_errorbar(aes(xmin = Lower, xmax = Upper, color=Chemical), width = 0.4, size=1.5) + 
  geom_point(size=1.5)+
  geom_vline(aes(xintercept=0),linetype="dotted",color="navyblue")+
  facet_wrap2(vars(Visit), nrow=6, scale="free") +
  scale_y_discrete(name="",breaks=NULL,limits = rev(levels(mixed_effect_plot$Chemical)))+ 
  scale_x_continuous(name="Beta \n (95% Confidence Interval)")+
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position="left",
        legend.title = element_text(colour = "black", face = "bold",size=9),
        legend.text = element_text(colour = "black",size=9),
        axis.text.y = element_blank(),
        axis.title.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.x = element_text(colour = "black", face = "bold",size=9),
        strip.text.y = element_text(colour = "black", face = "bold",size=9,angle=0))

pops_plasma_plot

```

